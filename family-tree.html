<!DOCTYPE html>
<html lang="mn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ú–∏–Ω–∏–π –º–æ–¥ ‚Äì Undes</title>

    <!-- –ó”©–≤—Ö”©–Ω —ç–Ω—ç —Ö—É—É–¥—Å–∞–Ω–¥ —Ö—ç—Ä—ç–≥—Ç—ç–π CSS -->
    <link rel="stylesheet" href="family-tree.css" />
  </head>

  <body>
    <!-- ========== HEADER ========== -->
    <header class="site-header">
      <!-- –õ–û–ì–û ‚Äì –¥—ç—ç—Ä –Ω—å –¥–∞—Ä–∞—Ö–∞–∞—Ä index.html —Ä—É—É –±—É—Ü–Ω–∞ -->
      <div class="logo" onclick="location.href='index.html'">
        <img src="logo.png" alt="Undes logo" />
        <span>Undes</span>
      </div>

      <div class="header-right">
        <!-- –ú–∏–Ω–∏–π –º–æ–¥ —Ç–æ–≤—á (–∂–∏–∂–∏–≥ –±–æ—Ä button) -->
        <button
          type="button"
          class="btn-my-tree"
          onclick="location.href='family-tree.html'"
        >
          –ú–∏–Ω–∏–π –º–æ–¥
        </button>

        <!-- –°–∞–π–Ω –±–∞–π–Ω–∞ —É—É, Javzaa -->
        <span id="welcome-text" class="welcome-text"></span>

        <!-- –ì–∞—Ä–∞—Ö ‚Äì –∂–∏—Ä–∏–π–Ω “Ø–≥ –º–∞—è–≥–∏–π–Ω —Ç–æ–≤—á -->
        <button type="button" id="logout-btn" class="btn-logout-link">
          –ì–∞—Ä–∞—Ö
        </button>
      </div>
    </header>

    <!-- ========== FAMILY TREE ========== -->
    <main class="tree-main">
      <!-- –î—ç—ç—Ä –≥–∞—Ä—á –∏—Ä—ç—Ö –Ω—ç—Ä -->
      <h2 id="tree-title" class="tree-title"></h2>

      <div class="tree-wrapper">
        <!-- –≠—Ü—ç–≥ -->
        <div class="tree-card parent">
          <button class="add-btn" type="button">+</button>
          <div class="icon">üë§</div>
          <div class="label">–≠—Ü—ç–≥</div>
        </div>

        <!-- –≠—Ö -->
        <div class="tree-card parent">
          <button class="add-btn" type="button">+</button>
          <div class="icon">üë§</div>
          <div class="label">–≠—Ö</div>
        </div>

        <!-- –ë–∏ / –ù—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ö—ç—Ä—ç–≥–ª—ç–≥—á -->
        <div class="tree-card self">
          <button class="add-btn" type="button">+</button>
          <div class="icon">üë§</div>
          <div class="label" id="self-name">–ë–∏</div>
        </div>
      </div>
    </main>

    <!-- ========== FIREBASE AUTH SCRIPT ========== -->
    <script type="module">
      import {
        initializeApp
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";

      import {
        getAuth,
        onAuthStateChanged,
        signOut
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

      // –ß–∏–Ω–∏–π ”©–º–Ω”© —Ö—ç—Ä—ç–≥–ª—ç–∂ –±–∞–π—Å–∞–Ω config-–∏–π–≥ —à—É—É–¥ –∞—à–∏–≥–ª–∞—è
      const firebaseConfig = {
        apiKey: "AIzaSyC3Mu5W0Aol7DvtQ28mdtnD1qWt426ea9U",
        authDomain: "undes-27404.firebaseapp.com",
        projectId: "undes-27404",
        storageBucket: "undes-27404.firebasestorage.app",
        messagingSenderId: "392425028546",
        appId: "1:392425028546:web:6f24b527752361db68b45b",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const welcomeTextEl = document.getElementById("welcome-text");
      const logoutBtn = document.getElementById("logout-btn");
      const treeTitleEl = document.getElementById("tree-title");
      const selfNameEl = document.getElementById("self-name");

      // –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω —Ç”©–ª”©–≤–∏–π–≥ —Å–æ–Ω—Å–æ—Ö
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          // –ù—ç–≤—Ç—Ä—ç—ç–≥“Ø–π –±–æ–ª –±—É—Ü–∞–∞–¥ –≥–æ–ª —Ö—É—É–¥–∞—Å —Ä—É—É
          window.location.href = "index.html";
          return;
        }

        const name = user.displayName || user.email.split("@")[0];

        // Header –¥—ç—ç—Ä
        welcomeTextEl.textContent = `–°–∞–π–Ω –±–∞–π–Ω–∞ —É—É, ${name}`;

        // –ú–æ–¥–Ω—ã –≥–∞—Ä—á–∏–≥
        treeTitleEl.textContent = name;

        // –î–æ–æ–¥ "–ë–∏" –¥—ç—ç—Ä—Ö –Ω—ç—Ä
        selfNameEl.textContent = name;
      });

      // –ì–∞—Ä–∞—Ö
      logoutBtn.addEventListener("click", () => {
        if (confirm("–ì–∞—Ä–∞—Ö —É—É?")) {
          signOut(auth).then(() => {
            window.location.href = "index.html";
          });
        }
      });
    </script>
  </body>
</html>